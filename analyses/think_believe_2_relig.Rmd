---
title: "Think Believe 2 (free response): Religious affiliation and religiosity"
output: 
  html_notebook:
    toc: true
    toc_float: true
---

```{r setup}
knitr::opts_chunk$set(echo = F, message = F)
```

In this notebook we consider the role of religious affiliation and religiosity in the second "think/believe" task, in which participants completed a series of fill-in-the-blanks with free responses.


```{r}
source("./scripts/dependencies.R")
source("./scripts/custom_funs.R")
source("./scripts/var_recode_contrast.R")
source("./scripts/data_prep.R")
```


# Demographics

First, let's just look at how people in different countries replied to the relevant questions. 

## Religious affiliation

### `thb2_demo_regp_1_TEXT`: "Are you a part of any religious group? If yes, what group?"

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "thb2_religion") +
  labs(x = "Are you a part of any religious group? If yes, what group?", 
       y = "proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
```

### `..._demo_rlgn`: "What religion do you practice, if any?"

This question was included in the bigger "packet" (not in the "Think Believe" survey itself). It was open-response, but here I've done my best to code the respones as "Christian," "Buddhist," "Other religious," or "Not religious."

Seems to have been omitted in Ghana?

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "religion") +
  labs(x = "What religion do you practice, if any?", 
       y = "proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
```

### Combining `thb2_demo_regp_1_TEXT` and `..._demo_rlgn`

Here I'll count someone as "Christian" if I coded their response to *either* `thb2_demo_regp_1_TEXT` or `..._demo_rlgn` as "Christian" (etc.).

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2 %>% 
                mutate(new_relig = case_when(
                  thb2_religion == "Christian" | 
                    religion == "Christian" ~ "Christian",
                  thb2_religion == "Buddhist" | 
                    religion == "Buddhist" ~ "Buddhist",
                  thb2_religion == "Other" | 
                    religion == "Other religious" ~ "Other religious",
                  religion == "Not religious" ~ "Not religious",
                  TRUE ~ NA_character_)) %>% 
                mutate(new_relig = factor(new_relig, 
                                          levels = c("Buddhist", "Christian",
                                                     "Other religious", 
                                                     "Not religious"))), 
              sample_size_d2, "new_relig") +
  labs(x = "Inferred religion", 
       y = "proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
```


## Religiosity

### `thb2_demo_regp`: "Are you a part of any religious group?"

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "thb2_demo_regp") +
  labs(x = "Are you a part of any religious group?", 
       y = "proportion")
```

### `thb2_demo_rely`: "From 1 to 7, how religious are you? (1 = not religious at all, 7 =
extremely religious)"

Seems to have been omitted in Thailand?

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "thb2_demo_rely") +
  labs(x = "From 1 to 7, how religious are you?", 
       y = "proportion")
```

### `thb2_demo_impr`: "From 1 to 7, how important to you is your religious practice?  (1 = not important at all, 7 = of utmost importance)"

Seems to have been omitted in Thailand?

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "thb2_demo_impr") +
  labs(x = "From 1 to 7, how important to you is your religious practice?", 
       y = "proportion")
```

### `thb2_demo_wors`: "How often do you attend places of worship?"

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "thb2_demo_wors") +
  labs(x = "How often do you attend places of worship?", 
       y = "proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
```

### `thb2_demo_bgod`: "What best describes your level of belief in God?"

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "thb2_demo_bgod") +
  labs(x = "What best describes your level of belief in God?", 
       y = "proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
```

### `thb2_demo_bbuh`: "What best describes your level of belief in Buddha?"

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "thb2_demo_bbuh") +
  labs(x = "What best describes your level of belief in Buddha?", 
       y = "proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
```

### `thb2_demo_bosp`: "What best describes your level of belief in another spiritual being (other than God or Buddha)?"

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "thb2_demo_bosp") +
  labs(x = "What best describes your level of belief in another spiritual being (other than God or Buddha)?", 
       y = "proportion") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1))
```

### `thb2_demo_atsn`: "What best describes your attitude towards the supernatural?

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "thb2_demo_atsn") +
  labs(x = "What best describes your attitude towards the supernatural?", 
       y = "proportion") +
  scale_x_discrete(labels = 1:5)
```

Response options:

1. "There is no such thing as supernatural forces or beings"
2. "We cannot know if there are supernatural forces and beings"
3. "There might be supernatural forces and beings"
4. "Supernatural forces and beings exist but we cannot know what they are like"
5. "There definitely are supernatural forces and beings"

### `thb2_demo_imsn`: "From 1 to 7, how important to you is your attitude toward the supernatural? (1 = not important at all, 7 = of utmost importance)"

```{r, fig.width = 4, fig.asp = 0.4}
demo_plot_fun(d2, sample_size_d2, "thb2_demo_imsn") +
  labs(x = "From 1 to 7, how important to you is your attitude toward the supernatural?", 
       y = "proportion")
```


# Analyses

Now, let's look at how responses to our think/believe questions might have varied depending on religion/religiosity. For now, I'll just focus on a couple of variables that seem to have been answered in reasonable ways.

## Religious affiliation

```{r}
d2_temp <- d2_long %>%
  # filter(country == "US") %>%
  mutate(relig_cat = case_when(
    thb2_religion == "Christian" | religion == "Christian" ~ "Christian",
    grepl("Other", thb2_religion) | 
      grepl("Other", religion) |
      grepl("Buddh", thb2_religion) | 
      grepl("Buddh", religion) ~ "Buddhist/Other",
    thb2_religion == "Not religious" | is.na(thb2_religion) |
      is.na(religion) ~ "Not religious",
    TRUE ~ NA_character_)) %>%
  mutate(relig_cat = factor(relig_cat,
                            levels = c("Christian", "Not religious", 
                                       "Buddhist/Other")))

sample_size_d2_temp <- d2_temp %>%
  distinct(country, thb2_subj, relig_cat) %>%
  count(country, relig_cat) %>%
  arrange(country, relig_cat) %>%
  mutate(lab = paste0(country, ": ", relig_cat, " (n=", n, ")"),
         order = 1:nrow(.),
         lab = reorder(lab, order))
```

### Believe\*

```{r, fig.width = 3, fig.asp = 1.2}
d2_temp %>% 
  select(-order) %>%
  left_join(sample_size_d2_temp) %>%
  ggplot(aes(x = super_cat, 
             # put NAs on top of bar
             fill = responseX_cat)) +
  facet_wrap(. ~ lab, ncol = 3) + #, scales = "free", space = "free") +
  geom_bar(position = "fill", alpha = 0.7, color = "black", size = 0.1) +
  # geom_hline(yintercept = 0.5, lty = 2) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
        legend.position = "top") +
  labs(x = "category", y = "proportion", fill = "response")
```

```{r}
r2.9_us <- lmer(believeX ~ super_cat * relig_cat
                # + (1 + super_cat | thb2_subj) + (1 | question), # failed to converge 
                # + (1 + super_cat || thb2_subj) + (1 | question), # failed to converge 
                + (1 | thb2_subj) + (1 | question),
                data = d2_temp %>%
                  filter(country == "US", 
                         relig_cat %in% c("Christian", "Not religious")),
                contrasts = list(relig_cat = "contr.sum"))
```

```{r}
regtab_fun(r2.9_us, 
           predictor_var1 = "relig_cat1", 
           predictor_name1 = "Religious affiliation (Christian vs. not religious)") %>%
  regtab_style_fun(row_emph = 4)
```

### "Know"

```{r, fig.width = 3, fig.asp = 1.2}
d2_temp %>% 
  select(-order) %>%
  left_join(sample_size_d2_temp) %>%
  ggplot(aes(x = category, 
             fill = responseX_cat4)) +
  facet_wrap(. ~ lab, ncol = 3) + #, scales = "free", space = "free") +
  geom_bar(position = "fill", alpha = 0.7, color = "black", size = 0.1) +
  # geom_hline(yintercept = 0.5, lty = 2) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
        legend.position = "top") +
  labs(x = "category", y = "proportion", fill = "response")
```

```{r, fig.width = 3, fig.asp = 1.2}
d2_temp %>% 
  select(-order) %>%
  left_join(sample_size_d2_temp) %>%
  ggplot(aes(x = category, 
             fill = recode_factor(as.character(knowX),
                                  "FALSE" = "other resposne",
                                  "TRUE" = "know*"))) +
  facet_wrap(. ~ lab, ncol = 3) + #, scales = "free", space = "free") +
  geom_bar(position = "fill", alpha = 0.7, color = "black", size = 0.1) +
  # geom_hline(yintercept = 0.5, lty = 2) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
        legend.position = "top") +
  labs(x = "category", y = "proportion", fill = "response")
```

```{r, fig.width = 5, fig.asp = 0.5}
d2_temp %>% 
  select(-order) %>%
  left_join(sample_size_d2_temp) %>%
  filter(grepl("US: Christian", lab) |
           grepl("US: Not religious", lab) |
           grepl("Ghana: Christian", lab) |
           grepl("China: Not religious", lab) |
           grepl("Thailand: Buddhist", lab) |
           grepl("Vanuatu: Christian", lab)) %>%
  count(lab, super_cat, category, knowX) %>%
  group_by(lab, super_cat, category) %>%
  mutate(prop = n/sum(n),
         relig = case_when(grepl("Christian", lab) ~ "Christian",
                           grepl("Buddh", lab) ~ "Buddhist",
                           grepl("Not religious", lab) ~ "Not religious")) %>%
  ungroup() %>%
  filter(knowX) %>%
  mutate(lab = gsub(": ", ":\n", lab)) %>%
  ggplot(aes(x = category, y = prop, fill = relig, alpha = super_cat)) +
  facet_grid(~ lab) +
  geom_bar(stat = "identity", color = "black", size = 0.2) +
  scale_fill_manual(values = c("darkblue", "darkred", "darkgreen")) +
  scale_alpha_manual(values = c(0.25, 0.75)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
        legend.position = "top") +
  labs(x = "category", y = "proportion saying 'know*' (truncated scale)",
       fill = "Participant religion", alpha = "Superordinate category")
```


## Religiosity

### `thb2_demo_rely`: “From 1 to 7, how religious are you? (1 = not religious at all, 7 = extremely religious)”

```{r, echo = T}
r2.6 <- lmer(believeX ~ super_cat * country * thb2_demo_rely_num
             + (1 + super_cat | thb2_subj) + (1 | question),
             data = d2_long %>% 
               filter(country != "Thailand") %>%
               mutate(thb2_demo_rely_num = scale(thb2_demo_rely_num)),
             contrasts = list(country = "contr.sum"))
```

```{r}
regtab_fun(r2.6, std_beta = T, 
           country_var1 = "country1", country_name1 = "Country (US)",
           country_var2 = "country2", country_name2 = "Country (Ghana)",
           country_var3 = "country3", country_name3 = "Country (China)",
           predictor_var1 = "thb2_demo_rely_num", 
           predictor_name1 = "How religious are you?") %>% 
  regtab_style_fun(row_emph = c(10, 14:16))
```

This analysis suggests that greater religiosity was NOT associated with an increased distinction between religious and fact questions. (Note that this analysis omits participants from Thailand, who did not answer this question about religiosity.)

```{r}
d2_long %>% 
  filter(country != "Thailand") %>%
  group_by(country, thb2_subj, thb2_demo_rely_num, super_cat) %>%
  summarise(believe_prop = mean(believeX, na.rm = T)) %>%
  ungroup() %>%
  ggplot(aes(x = thb2_demo_rely_num, y = believe_prop, color = super_cat)) +
  facet_grid(. ~ country) +
  geom_jitter(alpha = 0.2, width = 0.1, height = 0.02) +
  geom_smooth(method = "lm") +
  scale_x_continuous(breaks = 0:6, labels = levels(d2$thb2_demo_rely)) +
  theme(legend.position = "top") +
  labs(x = "How religious are you?", y = "Proportion 'believeX' responses",
       color = "Category")
```

```{r}
d2_long %>% 
  filter(country != "Thailand") %>%
  group_by(country, thb2_subj, thb2_demo_rely_num, super_cat) %>%
  summarise(believe_prop = mean(believeX, na.rm = T)) %>%
  ungroup() %>%
  spread(super_cat, believe_prop) %>%
  mutate(diff = religious - fact) %>%
  ggplot(aes(x = thb2_demo_rely_num, y = diff)) +
  facet_grid(. ~ country) +
  geom_jitter(alpha = 0.2, width = 0.1, height = 0.02) +
  geom_smooth(method = "lm") +
  scale_x_continuous(breaks = 0:6, labels = levels(d2$thb2_demo_rely)) +
  theme(legend.position = "top") +
  labs(x = "How religious are you?", 
       y = "Difference in proportion 'believeX' responses\n(religious questions - fact questions)",
       color = "Category")
```

### `thb2_demo_impr`: "From 1 to 7, how important to you is your religious practice?  (1 = not important at all, 7 = of utmost importance)"

```{r, echo = T}
r2.7 <- lmer(believeX ~ super_cat * country * thb2_demo_impr_num
             + (1 + super_cat | thb2_subj) + (1 | question),
             data = d2_long %>% 
               filter(country != "Thailand") %>%
               mutate(thb2_demo_impr_num = scale(thb2_demo_impr_num)),
             contrasts = list(country = "contr.sum"))
```

```{r}
regtab_fun(r2.7, std_beta = T, 
           country_var1 = "country1", country_name1 = "Country (US)",
           country_var2 = "country2", country_name2 = "Country (Ghana)",
           country_var3 = "country3", country_name3 = "Country (China)",
           predictor_var1 = "thb2_demo_impr_num", 
           predictor_name1 = "How important is your religious practice?") %>% 
  regtab_style_fun(row_emph = c(10, 14:16))
```

This analysis suggests that more importance placed on religious practice was NOT associated with an increased distinction between religious and fact questions. (Note that this analysis omits participants from Thailand, who did not answer this question about religiosity.)

```{r}
d2_long %>% 
  filter(country != "Thailand") %>%
  group_by(country, thb2_subj, thb2_demo_impr_num, super_cat) %>%
  summarise(believe_prop = mean(believeX, na.rm = T)) %>%
  ungroup() %>%
  ggplot(aes(x = thb2_demo_impr_num, y = believe_prop, color = super_cat)) +
  facet_grid(. ~ country) +
  geom_jitter(alpha = 0.2, width = 0.1, height = 0.02) +
  geom_smooth(method = "lm") +
  scale_x_continuous(breaks = 0:6, labels = levels(d2$thb2_demo_impr)) +
  theme(legend.position = "top") +
  labs(x = "How important is your religious practice?", y = "Proportion 'believeX' responses",
       color = "Category")
```

```{r}
d2_long %>% 
  filter(country != "Thailand") %>%
  group_by(country, thb2_subj, thb2_demo_impr_num, super_cat) %>%
  summarise(believe_prop = mean(believeX, na.rm = T)) %>%
  ungroup() %>%
  spread(super_cat, believe_prop) %>%
  mutate(diff = religious - fact) %>%
  ggplot(aes(x = thb2_demo_impr_num, y = diff)) +
  facet_grid(. ~ country) +
  geom_jitter(alpha = 0.2, width = 0.1, height = 0.02) +
  geom_smooth(method = "lm") +
  scale_x_continuous(breaks = 0:6, labels = levels(d2$thb2_demo_impr)) +
  theme(legend.position = "top") +
  labs(x = "How important is your religious practice?", 
       y = "Difference in proportion 'believeX' responses\n(religious questions - fact questions)",
       color = "Category")
```

### `thb2_demowors`: "How often do you attend places of worship?"

```{r, echo = T}
r2.8 <- lmer(believeX ~ super_cat * country * thb2_demo_wors_num
             + (1 + super_cat | thb2_subj) + (1 | question),
             data = d2_long %>% 
               mutate(thb2_demo_wors_num = scale(thb2_demo_wors_num)))
```

```{r}
regtab_fun(r2.8, std_beta = T, 
           predictor_var1 = "thb2_demo_wors_num", 
           predictor_name1 = "How often do you attend places of worship?") %>% 
  regtab_style_fun(row_emph = c(12, 17:20))
```

This analysis suggests that frequency of attendence was NOT associated with an increased distinction between religious and fact questions. 

```{r}
d2_long %>% 
  group_by(country, thb2_subj, thb2_demo_wors_num, super_cat) %>%
  summarise(believe_prop = mean(believeX, na.rm = T)) %>%
  ungroup() %>%
  ggplot(aes(x = thb2_demo_wors_num, y = believe_prop, color = super_cat)) +
  facet_grid(. ~ country) +
  geom_jitter(alpha = 0.2, width = 0.1, height = 0.02) +
  geom_smooth(method = "lm") +
  scale_x_continuous(breaks = 0:4, labels = levels(d2$thb2_demo_wors)) +
  theme(legend.position = "top",
        axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1)) +
  labs(x = "How often do you attend places of worship?", 
       y = "Proportion 'believeX' responses",
       color = "Category")
```

```{r}
d2_long %>% 
  group_by(country, thb2_subj, thb2_demo_wors_num, super_cat) %>%
  summarise(believe_prop = mean(believeX, na.rm = T)) %>%
  ungroup() %>%
  spread(super_cat, believe_prop) %>%
  mutate(diff = religious - fact) %>%
  ggplot(aes(x = thb2_demo_wors_num, y = diff)) +
  facet_grid(. ~ country) +
  geom_jitter(alpha = 0.2, width = 0.1, height = 0.02) +
  geom_smooth(method = "lm") +
  scale_x_continuous(breaks = 0:4, labels = levels(d2$thb2_demo_wors)) +
  theme(legend.position = "top",
        axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1)) +
  labs(x = "How often do you attend places of worship?", 
       y = "Difference in proportion 'believeX' responses\n(religious questions - fact questions)",
       color = "Category")
```


