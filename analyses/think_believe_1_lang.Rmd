---
title: "Think Believe 1 (forced choice)"
output: 
  html_notebook:
    toc: true
    toc_float: true
---

```{r setup}
knitr::opts_chunk$set(echo = F, message = F)
```

In this notebook we analyze the first "think/believe" task, in which participants completed a series of fill-in-the-blanks by choosing between two options: "think" and "believe." This notebook focuses in particualr on exposure to English.


```{r}
source("./scripts/dependencies.R")
source("./scripts/custom_funs.R")
source("./scripts/var_recode_contrast.R")
source("./scripts/data_prep.R")
```


# Languages spoken

```{r}
d1_lang <- d1 %>% 
  mutate_at(vars(contains("flang"), contains("olang")),
            ~ tolower(.)) %>%
  mutate_at(vars(contains("flang"), contains("olang")),
            ~ sjmisc::set_na(., na = c("\\.", ".", "NA", "mdata", 
                             "missing", "missing data"))) %>%
  mutate(english = case_when(
    grepl("eng", tolower(demo_flang)) |
      grepl("eng", tolower(demo_olang_TEXT)) |
      grepl("eng", tolower(thb1_demo_flang)) |
      grepl("eng", tolower(thb1_demo_olang_1_TEXT)) ~ "English",
    is.na(demo_flang) & is.na(demo_olang_TEXT) &
      is.na(thb1_demo_flang) & is.na(thb1_demo_olang_1_TEXT) ~ NA_character_,
    TRUE ~ "No English"))
```

```{r}
d1_lang %>%
  count(country, english) %>%
  spread(english, n) %>%
  janitor::adorn_totals("row") %>%
  kable() %>%
  kable_styling()
```

## Plots

```{r, fig.width = 2.8, fig.asp = 0.7}
# after cogsci 2020 submission
d1_long %>%
  # left_join(sample_size_d1) %>%
  left_join(d1_lang %>% select(thb1_subj, english)) %>%
  filter(!is.na(english),
         !(country == "US" & english == "No English"),
         !(country == "China" & english == "No English")) %>%
  ggplot(aes(x = factor(super_cat, 
                        labels = c("relig.", "fact.")), 
             # put NAs on top of bar
             fill = factor(response_cat,
                           levels = c(NA, "think", "believe"), 
                           exclude = NULL))) +
  facet_grid(english ~ country, scales = "free", space = "free") +
  geom_bar(position = "fill", 
           alpha = 0.7, color = "black", size = 0.1) +
  scale_y_continuous(labels = scales::percent) +
  # geom_hline(yintercept = 0.5, lty = 2) +
  theme(#axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
        legend.position = "top") +
  labs(title = "Study 1",
       x = "Question type", y = "Percent of responses", fill = "Response")
```
```{r, fig.width = 2.8, fig.asp = 0.7}
# after cocci 2020 submission
d1_long %>%
  # left_join(sample_size_d1) %>%
  left_join(d1_lang %>% select(thb1_subj, english)) %>%
  filter(!is.na(english),
         !(country == "US" & english == "No English"),
         !(country == "China" & english == "No English")) %>%
  ggplot(aes(x = factor(super_cat, 
                        labels = c("relig.", "fact.")), 
             # put NAs on top of bar
             fill = factor(response_cat,
                           levels = c(NA, "think", "believe"), 
                           exclude = NULL))) +
  facet_grid(. ~ english, scales = "free", space = "free") +
  geom_bar(position = "fill", alpha = 0.7, color = "black", size = 0.1) +
  scale_y_continuous(labels = scales::percent) +
  # geom_hline(yintercept = 0.5, lty = 2) +
  theme(#axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
        legend.position = "top") +
  labs(x = "Question type", y = "Percent of responses", fill = "Response")
```
## Parallel to KW Analysis #1

```{r, echo = T}
# note: using most maximal common random effects structure
r1.6_eng <- lmer(believe ~ super_cat * country + 
                   (1 + super_cat | thb1_subj) + (1 | question),
                 # (1 + super_cat || thb1_subj) + (1 | question), 
                 # (1 | thb1_subj) + (1 | question),
                 # (1 + super_cat | thb1_subj),
                 data = d1_long %>%
                   left_join(d1_lang %>% select(thb1_subj, english)) %>%
                   filter(english == "English"))

r1.6_noeng <- lmer(believe ~ super_cat * country + 
                     (1 + super_cat | thb1_subj) + (1 | question),
                   # (1 + super_cat || thb1_subj) + (1 | question), 
                   # (1 | thb1_subj) + (1 | question),
                   # (1 + super_cat | thb1_subj),
                   data = d1_long %>%
                     left_join(d1_lang %>% select(thb1_subj, english)) %>%
                     filter(english == "No English",
                            country %in% c("Ghana", "Thailand", "Vanuatu")) %>%
                     mutate(country = factor(country, 
                                             levels = c("Ghana", "Thailand", 
                                                        "Vanuatu"))),
                   contrasts = list(country = cbind("_gh" = c(1, 0, -1),
                                                    "_th" = c(0, 1, -1))))
```

```{r}
bind_rows(regtab_fun(r1.6_eng, std_beta = F) %>% 
            mutate(Language = "English"),
          regtab_fun(r1.6_noeng, std_beta = F) %>% 
            mutate(Language = "No English")) %>%
  select(Language, everything()) %>%
  regtab_style_fun(row_emph = c(2, 12)) %>%
  collapse_rows(1)
```

## Parallel to KW Analysis #1 (with interaction)

```{r, echo = T}
# note: using most maximal common random effects structure
r1.7 <- lmer(believe ~ super_cat * country * english + 
               (1 + super_cat | thb1_subj) + (1 | question),
             # (1 + super_cat || thb1_subj) + (1 | question), 
             # (1 | thb1_subj) + (1 | question),
             # (1 + super_cat | thb1_subj),
             data = d1_long %>%
               left_join(d1_lang %>% select(thb1_subj, english)) %>%
               mutate(english = factor(english, 
                                       levels = c("English", "No English"))),
             contrasts = list(english = cbind("No Eng. vs. GM" = c(-1, 1))))
```

```{r}
regtab_fun(r1.7) %>%
  regtab_style_fun(row_emph = 2) %>%
  collapse_rows(1)
```

## Parallel to KW Analysis #1 (by country)

```{r}
r1.8_eng_gh <- lmer(believe ~ super_cat + 
                        (1 + super_cat | thb1_subj) + (1 | question),
                      # (1 + super_cat || thb1_subj) + (1 | question), 
                      # (1 | thb1_subj) + (1 | question),
                      # (1 + super_cat | thb1_subj),
                      data = d1_long %>%
                        left_join(d1_lang %>% select(thb1_subj, english)) %>%
                        filter(english == "English", country == "Ghana"))

r1.8_noeng_gh <- lmer(believe ~ super_cat + 
                        (1 + super_cat | thb1_subj) + (1 | question),
                      # (1 + super_cat || thb1_subj) + (1 | question), 
                      # (1 | thb1_subj) + (1 | question),
                      # (1 + super_cat | thb1_subj),
                      data = d1_long %>%
                        left_join(d1_lang %>% select(thb1_subj, english)) %>%
                        filter(english == "No English", country == "Ghana"))

r1.8_eng_th <- lmer(believe ~ super_cat + 
                        (1 + super_cat | thb1_subj) + (1 | question),
                      # (1 + super_cat || thb1_subj) + (1 | question), 
                      # (1 | thb1_subj) + (1 | question),
                      # (1 + super_cat | thb1_subj),
                      data = d1_long %>%
                        left_join(d1_lang %>% select(thb1_subj, english)) %>%
                        filter(english == "English", country == "Thailand"))

r1.8_noeng_th <- lmer(believe ~ super_cat + 
                        (1 + super_cat | thb1_subj) + (1 | question),
                      # (1 + super_cat || thb1_subj) + (1 | question), 
                      # (1 | thb1_subj) + (1 | question),
                      # (1 + super_cat | thb1_subj),
                      data = d1_long %>%
                        left_join(d1_lang %>% select(thb1_subj, english)) %>%
                        filter(english == "No English", country == "Thailand"))

r1.8_eng_vt <- lmer(believe ~ super_cat + 
                        (1 + super_cat | thb1_subj) + (1 | question),
                      # (1 + super_cat || thb1_subj) + (1 | question), 
                      # (1 | thb1_subj) + (1 | question),
                      # (1 + super_cat | thb1_subj),
                      data = d1_long %>%
                        left_join(d1_lang %>% select(thb1_subj, english)) %>%
                        filter(english == "English", country == "Vanuatu"))

r1.8_noeng_vt <- lmer(believe ~ super_cat + 
                        (1 + super_cat | thb1_subj) + (1 | question),
                      # (1 + super_cat || thb1_subj) + (1 | question), 
                      # (1 | thb1_subj) + (1 | question),
                      # (1 + super_cat | thb1_subj),
                      data = d1_long %>%
                        left_join(d1_lang %>% select(thb1_subj, english)) %>%
                        filter(english == "No English", country == "Vanuatu"))
```

```{r}
bind_rows(regtab_fun(r1.8_eng_gh, std_beta = F) %>% 
            mutate(Country = "Ghana", Language = "English"),
          regtab_fun(r1.8_noeng_gh, std_beta = F) %>% 
            mutate(Country = "Ghana", Language = "No English"),
          regtab_fun(r1.8_eng_th, std_beta = F) %>% 
            mutate(Country = "Thailand", Language = "English"),
          regtab_fun(r1.8_noeng_th, std_beta = F) %>% 
            mutate(Country = "Thailand", Language = "No English"),
          regtab_fun(r1.8_eng_vt, std_beta = F) %>% 
            mutate(Country = "Vanuatu", Language = "English"),
          regtab_fun(r1.8_noeng_vt, std_beta = F) %>% 
            mutate(Country = "Vanuatu", Language = "No English")) %>%
  select(Country, Language, everything()) %>%
  regtab_style_fun(row_emph = seq(2, 12, 2)) %>%
  collapse_rows(1:2)
```

## Parallel to KW Analysis #2

```{r, echo = T}
# note: using random effects structure from Analysis #2 above
r1.9_eng <- lmer(believe ~ super_cat + 
                   # (1 + super_cat | country/thb1_subj) + (1 | question),
                 # (1 + super_cat || country/thb1_subj) + (1 | question),
                 (1 | country/thb1_subj) + (1 | question),
                 # (1 + super_cat | country/thb1_subj),
                 data = d1_long %>%
                   left_join(d1_lang %>% select(thb1_subj, english)) %>%
                   filter(english == "English") %>%
                   mutate(country = factor(country, levels = levels_country)))

r1.9_noeng <- lmer(believe ~ super_cat + 
                     # (1 + super_cat | country/thb1_subj) + (1 | question),
                   # (1 + super_cat || country/thb1_subj) + (1 | question),
                   (1 | country/thb1_subj) + (1 | question),
                   # (1 + super_cat | country/thb1_subj),
                   data = d1_long %>%
                     left_join(d1_lang %>% select(thb1_subj, english)) %>%
                     filter(english == "No English",
                            country %in% c("Ghana", "Thailand", "Vanuatu")) %>%
                     mutate(country = factor(country, 
                                             levels = c("Ghana", "Thailand", 
                                                        "Vanuatu"))))
```

```{r}
bind_rows(regtab_fun(r1.9_eng, std_beta = F) %>% 
            mutate(Language = "English"),
          regtab_fun(r1.9_noeng, std_beta = F) %>% 
            mutate(Language = "No English")) %>%
  select(Language, everything()) %>%
  regtab_style_fun(row_emph = c(2, 4)) %>%
  collapse_rows(1)
```

## Parallel to KW Analysis #2 (with interaction)

```{r, echo = T}
# note: using random effects structure from Analysis #2 above
r1.10 <- lmer(believe ~ super_cat * english + 
               # (1 + super_cat | country/thb1_subj) + (1 | question),
             # (1 + super_cat || country/thb1_subj) + (1 | question),
             (1 | country/thb1_subj) + (1 | question),
             # (1 + super_cat | country/thb1_subj),
             data = d1_long %>%
               left_join(d1_lang %>% select(thb1_subj, english)) %>%
               mutate(english = factor(english, 
                                       levels = c("English", "No English")),
                      country = factor(country, levels = levels_country)),
             contrasts = list(english = cbind("No Eng. vs. GM" = c(-1, 1))))
```

```{r}
regtab_fun(r1.10) %>%
  regtab_style_fun(row_emph = 2) %>%
  collapse_rows(1)
```
